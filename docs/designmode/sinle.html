<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>
<body>
  <script>
    function Universe() {

      // 判断是否存在实例
      if (typeof Universe.instance === 'object') {
          return Universe.instance;
      }

      // 其它内容
      this.start_time = 0;
      this.bang = "Big";

      // 缓存
      Universe.instance = this;

      // 隐式返回this
      }

      // 测试
      var uni = new Universe();
      var uni2 = new Universe();
      console.log(uni === uni2); // true
      console.log(uni.start_time)

    class Singleton {
      constructor(name) {
        this.name = name
        this.instance = null
      }
      static getInstance(name) {
        if (!this.instance) {
          this.instance =  new Singleton(name)
        }
        return this.instance
      }
    }
    const a = Singleton.getInstance('a')
    const b = Singleton.getInstance('b')
    console.log(a === b)
  </script>
  <script>
    class Dep {
      constructor() {
        this.subscribers = new Set() 
      }
      depend() {
        if (activeUpdate) {
          // 添加依赖
          this.subscribers.add(activeUpdate)
        }
      }
      notify() {
        this.subscribers.forEach(sub => sub())
      }
    }
    let activeUpdate
    function autorun(update) {
      function wrap() {
        activeUpdate = wrap
        update()
        activeUpdate = null
      }
      wrap()
    }
    const dep = new Dep()
    autorun(() => {
      dep.depend()
    }) 
    Object.keys(obj).forEach((key) => {
      let internalValue = obj[key]
      Object.defineProperties(obj, key, {
        get() {
          return internalValue
        },
        set(newValue) {
          internalValue = newV
        }
      })
    })
  </script>
</body>
</html>